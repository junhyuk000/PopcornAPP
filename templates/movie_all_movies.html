{% extends 'movie_base.html' %}

{% block content %}
<div class="container">
    <h1 class="mt-4 mb-4 text-center">🎬 영화 데이터 조회</h1>

    <!-- 검색 필터 -->
    <div class="row mb-3">
        <div class="col-md-4">
            <label>제목</label>
            <input type="text" id="title" class="form-control" placeholder="영화 제목 입력">
        </div>
        <div class="col-md-4">
            <label>장르</label>
            <select id="genre" class="form-control">
                <option value="">-- 전체 --</option>
                {% for g in filters.genres %}
                <option value="{{ g }}">{{ g }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <label>국가</label>
            <select id="nation" class="form-control">
                <option value="">-- 전체 --</option>
                {% for n in filters.nations %}
                <option value="{{ n }}">{{ n }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-4">
            <label>감독</label>
            <input type="text" id="director" class="form-control" placeholder="감독 입력">
        </div>
        <div class="col-md-4">
            <label>배우</label>
            <input type="text" id="actor" class="form-control" placeholder="배우 입력">
        </div>
        <div class="col-md-4 d-flex align-items-end">
            <button class="btn btn-primary w-100" onclick="searchMovies()">🔍 검색</button>
        </div>
    </div>

    <!-- 테이블 -->
    <table id="movieTable" class="table table-striped">
        <thead>
            <tr>
                <th>순위</th>
                <th>제목</th>
                <th>장르</th>
                <th>국가</th>
                <th>감독</th>
                <th>배우</th>
                <th>매출액</th>
                <th>관객수</th>
            </tr>
        </thead>
        <tbody id="movieData"></tbody>
    </table>
</div>

<!-- AJAX -->
<script>
    function searchMovies() {
        let query = `?title=${document.getElementById("title").value}&genre=${document.getElementById("genre").value}&nation=${document.getElementById("nation").value}&director=${document.getElementById("director").value}&actor=${document.getElementById("actor").value}`;
        fetch(`/filter${query}`)
            .then(response => response.json())
            .then(data => updateTable(data));
    }
</script>

{% endblock %}
